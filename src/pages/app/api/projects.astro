---
export const partial = true

import { addProject } from '@data/pocketbase'

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData()

  const team_id = formData.get('team_id')?.toString() || ''
  const project_name = formData.get('project_name')?.toString() || ''

  let project

  try {
    await addProject(Astro.locals.pb, project_name)
  } catch (e) {
    return new Response('An error occurred', {
      status: 400,
    })
  }

  Astro.response.headers.set('HX-Redirect', `/app/project/${project.id}`)
}
---
